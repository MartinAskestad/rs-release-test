name: Build and Release

on:
  release:
    types: [created]
  push:

jobs:
  build:
      runs-on: windows-latest
      steps:
        - uses: actions/checkout@master
        - uses: actions-rs/toolchain@v1
          with:
            toolchain: stable
        - uses: actions-rs/cargo@v1
          with:
            command: build
            args: --release
        - name: Create zip file
          run: |
            $outputPath = "${{ github.workspace }}\rust-bleh.zip"
            Compress-Archive -Path "${{ github.workspace }}\target\release\rust-bleh.exe" -DestinationPath $outputPath
          shell: pwsh
        - name: Archive production artifacts
          uses: actions/upload-artifact@v3
          with:
            name: rust-bleh.zip
            path: |
              rust-bleh.zip
        - name: Create release
          if: github.event_name == 'release'
          uses: softprops/action-gh-release@v1
          with:
            files: "${{ github.workspace }}/rust-bleh.zip"